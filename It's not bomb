<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„Ø¹Ø¨Ø© Ø³ÙŠØ§Ø±Ø© 3D - Ù†Ø³Ø®Ø© Ø§Ù„Ù‡Ø§ØªÙ</title>
<style>
body { margin:0; overflow:hidden; font-family:sans-serif; }
#overlay {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; flex-direction:column;
  color:white; font-size:2em; z-index:10; text-align:center;
}
button { padding:15px 30px; font-size:1em; cursor:pointer; margin-top:20px; border:none; border-radius:8px; background:#ff5722; color:white;}
#touchControls {
  position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
  display:flex; gap:15px; z-index:5;
}
.touchBtn {
  width:60px; height:60px; background:rgba(255,87,34,0.7); border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:2em; color:white; user-select:none;
}
</style>
</head>
<body>

<div id="overlay">
  ğŸš— Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© 3D ğŸš—<br>
  Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø³Ù‡Ù… Ø£Ùˆ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„ØªØ­ÙƒÙ…<br>
  <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>

<div id="touchControls" style="display:none;">
  <div class="touchBtn" id="up">â†‘</div>
  <div class="touchBtn" id="left">â†</div>
  <div class="touchBtn" id="down">â†“</div>
  <div class="touchBtn" id="right">â†’</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.156.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.156.0/examples/js/controls/OrbitControls.js"></script>

<script>
let scene, camera, renderer, car, controls, buildings=[], clock;
let keys={};
let engineSound, music;

function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0xa0a0a0);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0,10,20);

  const light = new THREE.DirectionalLight(0xffffff,1);
  light.position.set(20,40,20);
  light.castShadow = true;
  scene.add(light);
  scene.add(new THREE.AmbientLight(0x404040));

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled=true;
  document.body.appendChild(renderer.domElement);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.target.set(0,0.5,0);
  controls.enablePan=false; controls.enableZoom=false; controls.update();

  // Ø§Ù„Ø£Ø±Ø¶ÙŠØ©
  const ground = new THREE.Mesh(new THREE.PlaneGeometry(100,100), new THREE.MeshStandardMaterial({color:0x444444}));
  ground.rotation.x=-Math.PI/2; ground.receiveShadow=true; scene.add(ground);

  // Ø´ÙˆØ§Ø±Ø¹
  for(let i=-40;i<=40;i+=10){
    const roadX = new THREE.Mesh(new THREE.PlaneGeometry(10,100), new THREE.MeshStandardMaterial({color:0x222222}));
    roadX.rotation.x=-Math.PI/2; roadX.receiveShadow=true; roadX.position.x=i; scene.add(roadX);
    const roadZ = new THREE.Mesh(new THREE.PlaneGeometry(100,10), new THREE.MeshStandardMaterial({color:0x222222}));
    roadZ.rotation.x=-Math.PI/2; roadZ.receiveShadow=true; roadZ.position.z=i; scene.add(roadZ);
  }

  // Ù…Ø¨Ø§Ù†ÙŠ
  function createBuilding(x,z,w,h,d){
    const building = new THREE.Mesh(new THREE.BoxGeometry(w,h,d),
      new THREE.MeshStandardMaterial({color:Math.random()*0xffffff}));
    building.position.set(x,h/2,z); building.castShadow=true; building.receiveShadow=true;
    scene.add(building); buildings.push(building);
  }
  for(let x=-45;x<=45;x+=15){
    for(let z=-45;z<=45;z+=15){
      if(Math.abs(x)<=10 && Math.abs(z)<=10) continue;
      createBuilding(x,z,5,Math.random()*15+5,5);
    }
  }

  // Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
  car = new THREE.Mesh(new THREE.BoxGeometry(2,1,4), new THREE.MeshStandardMaterial({color:0xff0000}));
  car.position.y=0.5; car.castShadow=true; car.receiveShadow=true; scene.add(car);

  clock = new THREE.Clock();

  // Ø£ØµÙˆØ§Øª
  engineSound = new Audio('https://freesound.org/data/previews/250/250629_4486188-lq.mp3');
  engineSound.loop=true; engineSound.volume=0.3;
  music = new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3');
  music.loop=true; music.volume=0.2;

  animate();
  engineSound.play(); music.play();
}

function checkCollision(){
  for(let b of buildings){
    const dx=Math.abs(car.position.x-b.position.x);
    const dz=Math.abs(car.position.z-b.position.z);
    if(dx<2+2.5 && dz<2+2.5){
      car.position.x -= keys['ArrowLeft']?-0.5:keys['ArrowRight']?0.5:0;
      car.position.z -= keys['ArrowUp']?-0.5:keys['ArrowDown']?0.5:0;
    }
  }
}

function animate(){
  requestAnimationFrame(animate);
  if(keys['ArrowUp']) car.position.z -= 0.3;
  if(keys['ArrowDown']) car.position.z += 0.3;
  if(keys['ArrowLeft']) car.position.x -= 0.3;
  if(keys['ArrowRight']) car.position.x += 0.3;

  checkCollision();

  camera.position.x = car.position.x + 10;
  camera.position.z = car.position.z + 15;
  camera.lookAt(car.position);

  renderer.render(scene,camera);
}

window.addEventListener('resize', ()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
document.getElementById('startBtn').addEventListener('click', ()=>{
  document.getElementById('overlay').style.display='none';
  document.getElementById('touchControls').style.display='flex';
  init();
});

// Ø£Ø²Ø±Ø§Ø± Ù„Ù…Ø³
['up','down','left','right'].forEach(dir=>{
  const btn=document.getElementById(dir);
  btn.addEventListener('touchstart',()=>{ keys['Arrow'+dir[0].toUpperCase() + dir.slice(1)] = true; });
  btn.addEventListener('touchend',()=>{ keys['Arrow'+dir[0].toUpperCase() + dir.slice(1)] = false; });
});
</script>

</body>
</html>
